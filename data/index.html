<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]>      <html class="no-js"> <![endif]-->
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>RGB Light</title>
    <meta name="description" content="RGB Strip light controller web front end">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2/dist/spectrum.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/spectrum-colorpicker2/dist/spectrum.min.css">
    <link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
    <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

    <div class="container-fluid bg-1 text-center">
        <h1>RGB Light Control</h1>
        <button id="redButton" class="btn btn-lg btn-danger">Red</button>
        <button id="greenButton" class="btn btn-lg btn-success">Green</button>
        <button id="yellowButton" class="btn btn-lg btn-warning">Yellow</button>
        <button id="blueButton" class="btn btn-lg btn-primary">Blue</button>
        <button id="whiteButton" class="btn btn-lg btn-light">White</button>
    </div>
    <div class="container-fluid text-center">
        <form action="/post" method="POST" class="colorForm">
        <h3 class="colorForm" value="">Current Color: <BR> %CURRENT_COLOR%</h3>
            <label class="colorForm" for="color">Hex Color: #</label>
            <!--<input type="text" id="color" value="%HEXCOLOR%">-->
            <input type="text" id="color" />
        </form>
        <label for="mqtt">MQTT Enabled: </label>
            <form action="/post" method="POST" id="mqttform">
            <input type="checkbox" id="mqtt" value="%MQTTENABLE">
        </form>
    </div>
    <div class="container-fluid bg-2 text-center settings">
        <h3>Settings</h3>
        <form action="/post">
        <div class="row">
                <div class="col-sm">
                    <label for="svr"> MQTT Server Address:</label>
                    <input type="text" class="form-control mqttenable" id="svr" value="%SERVER%">
                </div>
                <div class="col-sm">
                    <label for="topic"> Base Topic:</label>
                    <input type="text" class="form-control mqttenable" id="topic" value="%BASETOPIC%">
                </div>
        </div>
        <div class="row">
                <div class="col-sm">
                    <label for="username">username:</label>
                    <input type="text" class="form-control mqttenable" id="usr" value="%USERNAME%">
                </div>
                <div class="col-sm">
                    <label for="password">password:</label>
                    <input type="password" class="form-control mqttenable" id="pwd" value="%PASS%">
                </div>
        </div>
        </form>
        <div class="row">
            <div class="col-sm"></div>
            <div class="col-sm">
                <br>
                <button class="btn btn-success mqttenable">Submit</button>
            </div>
            <div class="col-sm"></div>
        </div>
    </div>
</body>
<script>
    toggleMqtt();
    function toggleMqtt(){
        if($("#mqtt").is(":checked")) { 
                $(".bg-2").show();
                $.ajax({    
                    url: '/post',
                    type: 'POST',
                    data: { "mqtt": "on" }
                });
                //$(".mqttenable").prop('disabled', false);
                console.log("on")
            } else {
                $(".bg-2").hide();
                $.ajax({
                    url: '/post',
                    type: 'POST',
                    data: { "mqtt": "off" }
                });
               // $(".mqttenable").prop('disabled', true);
                console.log("off")

            }
    }
    $("#color").spectrum({
        showPalette: false,
        allowEmpty: true,
    });
    $(document).ready(function(e) {
        
        $("#mqtt").change(function() { 
            toggleMqtt();
        }); 
        $("#redButton").click(function () {
            $.ajax({    
                    url: '/post',
                    type: 'POST',
                    data: { "color": [255,0,0,0]  }
            });
            //alert("red")
        })
        $("#greenButton").click(function () {
            $.ajax({    
                    url: '/post',
                    type: 'POST',
                    data: { "color": [0,255,0,0] }
            });
            //alert("green")
        })
        $("#yellowButton").click(function () {
            $.ajax({    
                    url: '/post',
                    type: 'POST',
                    data: { "color": [255,255,0,0] }
            });
        })   
        $("#blueButton").click(function () {
            $.ajax({    
                    url: '/post',
                    type: 'POST',
                    data: { "color": [0,0,255,0]  }
            });
        })   
        $("#whiteButton").click(function () {
            $.ajax({    
                    url: '/post',
                    type: 'POST',
                    data: { "color": [0,0,0,255] }
            });
        })
        $("#color").on('focusout',function () {
        hexcode = hexToRgb($("#color").val());
        console.log(hexcode);
        $.ajax({    
                    url: '/post',
                    type: 'POST',
                    data: { "color": hexcode }
            });        
        })      
    });
    function hexToRgb(hex) {
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
    } : null;
}
</script>
<footer class="container-fluid bg-4 text-center">
    <p>RGBW Strip Controller
        <br><a href="mailto:errol@sufet.com">errol@sufet.com</a>
    </p>
</footer>

</html>